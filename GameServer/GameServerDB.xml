<?xml version="1.0" encoding="utf-8"?>

<GameServerDB>
  <!-- 플레이어 테이블 -->
  <Table name="Player" desc="Player Table">
    <Column name="PlayerDBId" type="BigInt" notnull="true" identity="1,1"/>
    <Column name="AccountDBId" type="BigInt" notnull="true"/>
    <Column name="PlayerName" type="nvarchar(20)" notnull="true"/>
    <Column name="PlayerType" type="SmallInt" notnull="true"/>
    <Column name="PlayerIndex" type="TinyInt" notnull="true"/>
    <Column name="Level" type="int" notnull="true"/>
    <Column name="CurrentHP" type="int" notnull="true"/>
    <Column name="MaxHP" type="int" notnull="true"/>
    <Column name="MinAttack" type="int" notnull="true"/>
    <Column name="MaxAttack" type="int" notnull="true"/>
    <Column name="CriticalPoint" type="SmallInt" notnull="true"/>
    <Column name="Speed" type="float" notnull="true"/>
    <Index type="clustered">
      <PrimaryKey/>
      <Column name="PlayerDBId"/>
    </Index>    
    <Index type="nonclustered">
      <UniqueKey/>
      <Column name="PlayerName"/>
    </Index>
  </Table>
  
  <!-- 아이템 테이블 -->
  <Table name="Item" desc="Item Table">
    <Column name="ItemDBId" type="BigInt" notnull="true" identity="1,1"/>
    <Column name="ItemUse" type="bit" notnull="true"/>        
    <Column name="ItemType" type="SmallInt" notnull="true"/>
    <Column name="ItemConsumableType" type="SmallInt" notnull="true"/>>
    <Column name="ItemName" type="nvarchar(20)" notnull="true"/>    
    <Column name="ItemCount" type="SmallInt" notnull="true"/>
    <Column name="IsEquipped" type="bit"/>
    <Column name="ThumbnailImagePath" type="nvarchar(100)" notnull="true"/>
    <Index type="clustered">
      <PrimaryKey/>
      <Column name="ItemDBId"/>
    </Index>    
  </Table>
  
  <!-- 인벤토리 아이템 테이블 -->
  <Table name="Inventory" desc="Inventory Table">    
    <Column name="ItemType" type="SmallInt" notnull="true"/>
    <Column name="ItemConsumableType" type="SmallInt" notnull="true"/>>
    <Column name="ItemName" type="nvarchar(20)" notnull="true"/>
    <Column name="ItemCount" type="SmallInt" notnull="true"/>
    <Column name="SlotIndex" type="TinyInt" notnull="true"/>
    <Column name="IsEquipped" type="bit"/>    
    <Column name="ThumbnailImagePath" type="nvarchar(100)" notnull="true"/>
    <Column name="OwnerAccountDBId" type="BigInt" notnull="true"/>
    <Column name="OwnerPlayerDBId" type="BigInt" notnull="true"/>        
  </Table>

  <!-- 골드 테이블 -->
  <Table name="Gold" desc="Gold Table">
    <Column name="AccountDBId" type="BigInt" notnull="true"/>
    <Column name="PlayerDBId" type="BigInt" notnull="true"/>
    <Column name="GoldCoin" type="BigInt" notnull="true"/>
    <Column name="SliverCoin" type="TinyInt" notnull="true"/>
    <Column name="BronzeCoin" type="TinyInt" notnull="true"/>
    <Index type="clustered">
      <PrimaryKey/>
      <Column name="PlayerDBId"/>
    </Index>
  </Table>

  <!-- 보유중인 스킬 목록 테이블 -->
  <Table name="SKill" desc="Skill Table">
    <Column name="AccountDBId" type="BigInt" notnull ="true"/>
    <Column name="PlayerDBId" type="BigInt" notnull ="true"/>
    <Column name="SkillType" type="SmallInt" notnull ="true"/>
    <Column name="SkillLevel" type="TinyInt" notnull ="true"/>
    <Column name="SkillName" type="nvarchar(20)" notnull ="true"/>
    <Column name="SkillCoolTime" type="int" notnull ="true"/>
    <Column name="SlotIndex" type="TinyInt" notnull="true"/>
    <Column name="SkillImagePath" type="nvarchar(100)" notnull="true"/>
  </Table>
  
  <!-- 보유중인 퀵슬롯바 목록 테이블 -->
  <Table name="QuickSlotBar" desc="QuickSlotBar Table">
    <Column name="AccountDBId" type="BigInt" notnull ="true"/>
    <Column name="PlayerDBId" type="BigInt" notnull ="true"/>
    <Column name="QuickSlotBarIndex" type="TinyInt" notnull ="true"/>
    <Column name="QuickSlotBarItemIndex" type="TinyInt" notnull ="true"/>
    <Column name="SkillType" type="SmallInt" notnull ="true"/>
    <Column name="SkillLevel" type="TinyInt" notnull ="true"/>
    <Column name="SkillName" type="nvarchar(20)" notnull ="true"/>
    <Column name="SkillCoolTime" type="int" notnull ="true"/>    
    <Column name="SkillImagePath" type="nvarchar(100)" notnull="true"/>    
  </Table> 
  
  <Procedure name="spGetPlayers">
    <Param name="@AccountId" type="BigInt"/>
    <Body>
      <![CDATA[
        SELECT PlayerDBId, PlayerName, PlayerIndex, Level, CurrentHP, MaxHP, MinAttack, MaxAttack, CriticalPoint, Speed, PlayerType FROM [dbo].[Player] WHERE AccountDBId = (@AccountId)
      ]]>
    </Body>
  </Procedure>

  <Procedure name="spGetCharacterName">
    <Param name="@CharacterName" type="nvarchar(20)"/>
    <Body>
      <![CDATA[
        SELECT * FROM [dbo].[Player] WHERE EXISTS (SELECT PlayerName FROM [dbo].[Player] WHERE PlayerName = (@CharacterName))
      ]]>
    </Body>
  </Procedure>

  <!-- 새로운 캐릭터 DB에 넣기 -->
  <Procedure name="spNewCharacterPush">
    <Param name="@AccountId" type="BigInt"/>
    <Param name="@PlayerName" type="nvarchar(20)"/>
    <Param name="@PlayerType" type="TinyInt"/>
    <Param name="@PlayerIndex" type="TinyInt"/>
    <Param name="@Level" type="int"/>
    <Param name="@CurrentHP" type="int"/>
    <Param name="@MaxHP" type="int"/>
    <Param name="@MinAttack" type="int"/>
    <Param name="@MaxAttack" type="int"/>
    <Param name="@CriticalPoint" type="SmallInt"/>
    <Param name="@Speed" type="float"/>
    <Body>
      <![CDATA[
        INSERT INTO [dbo].[Player] VALUES ((@AccountId),(@PlayerName),(@PlayerType),(@PlayerIndex),(@Level),(@CurrentHP),(@MaxHP),(@MinAttack),(@MaxAttack),(@CriticalPoint),(@Speed))        
      ]]>
    </Body>
  </Procedure>

  <!-- 만든 캐릭터 DBId 가져오기 -->
  <Procedure name="spPlayerDBIdGet">
    <Param name="@AccountDBId" type="BigInt"/>
    <Param name="@PlayerIndex" type="TinyInt"/>
    <Body>
      <![CDATA[
        SELECT PlayerDBId FROM [dbo].[Player] WHERE AccountDBId = (@AccountDBId) AND PlayerIndex = (@PlayerIndex)
      ]]>
    </Body>
  </Procedure>

  <!-- GoldTable 생성-->
  <Procedure name="spGoldTableCreate">
    <Param name="@AccountDBId" type="BigInt"/>
    <Param name="@PlayerDBId" type="BigInt"/>    
    <Body>
      <![CDATA[
        INSERT INTO [dbo].[Gold] VALUES ((@AccountDBId),(@PlayerDBId),(0),(0),(0))
      ]]>
    </Body>
  </Procedure>
  
  <!-- GoldTable에 Gold 저장 -->
  <Procedure name="spGoldSave">
    <Param name="@AccountDBId" type="BigInt"/>
    <Param name="@PlayerDBId" type="BigInt"/>    
    <Param name="@GoldCount" type="BigInt"/>
    <Param name="@SliverCount" type="TinyInt"/>
    <Param name="@BronzeCount" type="TinyInt"/>
    <Body>
      <![CDATA[
        UPDATE [dbo].[Gold] SET GoldCoin = (@GoldCount), SliverCoin = (@SliverCount), BronzeCoin = (@BronzeCount) WHERE AccountDBId = (@AccountDBId) AND PlayerDBId = (@PlayerDBId)
      ]]>
    </Body>    
  </Procedure>

  <!-- GoldTable에 저장되어 있는 정보 긁어오기 -->
  <Procedure name="spGetGoldTableInfoToInventory">
    <Param name="@AccountDBId" type="BigInt"/>
    <Param name="@PlayerDBId" type="BigInt"/>
    <Body>
      <![CDATA[
        SELECT GoldCoin, SliverCoin, BronzeCoin FROM [dbo].[Gold] WHERE AccountDBId = (@AccountDBId) AND PlayerDBId = (@PlayerDBId)
      ]]>
    </Body>
  </Procedure>
  
  <!-- ItemTable에 새로운 아이템 생성 -->
  <Procedure name="spItemCreate">
    <Param name ="@ItemUse" type="bit"/>
    <Param name ="@ItemType" type="SmallInt"/>
    <Param name ="@ItemConsumableType" type="SmallInt"/>
    <Param name ="@ItemName" type="nvarchar(20)"/>
    <Param name ="@ItemCount" type="SmallInt"/>
    <Param name ="@IsEquipped" type="bit"/>
    <Param name ="@ThumbnailImagePath" type="nvarchar(100)"/>
    <Body>
      <![CDATA[
         INSERT INTO [dbo].[Item] VALUES ((@ItemUse),(@ItemType),(@ItemConsumableType),(@ItemName),(@ItemCount),(@IsEquipped),(@ThumbnailImagePath))
       ]]>
    </Body>    
  </Procedure>

  <!-- 만든 아이템 DBId 가져오기 -->
  <Procedure name="spItemDBIdGet">
    <Body>
      <![CDATA[
        SELECT IDENT_CURRENT('Item')
      ]]>
    </Body>
  </Procedure>
  
  <!-- InventoryTable 빈껍데기 아이템 정보 저장-->  
  <Procedure name="spItemToInventoryInit">    
    <Param name="@ItemType" type="SmallInt"/>
    <Param name="@ItemConsumableType" type="SmallInt"/>
    <Param name="@ItemName" type="nvarchar(20)"/>
    <Param name="@ItemCount" type="SmallInt"/>    
    <Param name="@SlotIndex" type="TinyInt"/>
    <Param name="@IsEquipped" type="bit"/>        
    <Param name="@ThumbnailImagePath" type="nvarchar(100)"/>
    <Param name="@OwnerAccountDBId" type="BigInt"/>
    <Param name="@OwnerPlayerDBId" type="BigInt"/>    
    <Body>
      <![CDATA[
        INSERT INTO [dbo].[Inventory] VALUES ((@ItemType),(@ItemConsumableType),(@ItemName),(@ItemCount),(@SlotIndex),(@IsEquipped),(@ThumbnailImagePath),(@OwnerAccountDBId),(@OwnerPlayerDBId))
      ]]>
    </Body>
  </Procedure> 
  
  <!-- InventoryTable에 새로운 아이템 저장 -->
  <Procedure name="spItemToInventorySave">    
    <Param name="@ItemType" type="SmallInt"/>
    <Param name="@ItemConsumableType" type="SmallInt"/>
    <Param name="@ItemName" type="nvarchar(20)"/>
    <Param name="@ItemCount" type="SmallInt"/>    
    <Param name="@SlotIndex" type="TinyInt"/>
    <Param name="@IsEquipped" type="bit"/>        
    <Param name="@ThumbnailImagePath" type="nvarchar(100)"/>
    <Param name="@OwnerAccountDBId" type="BigInt"/>
    <Param name="@OwnerPlayerDBId" type="BigInt"/>    
    <Body>
      <![CDATA[
        UPDATE [dbo].[Inventory] SET ItemType = (@ItemType), ItemConsumableType = (@ItemConsumableType), ItemName = (@ItemName), ItemCount = (@ItemCount), IsEquipped = (@IsEquipped), ThumbnailImagePath = (@ThumbnailImagePath) WHERE SlotIndex = (@SlotIndex) AND OwnerAccountDBId = (@OwnerAccountDBId) AND OwnerPlayerDBId = (@OwnerPlayerDBId)        
      ]]>
    </Body>
  </Procedure> 
  
  <!-- ItemTable에 아이템 갱신 -->
  <Procedure name="spItemRefreshCount">
    <Param name="@OwnerAccountDBId" type="BigInt"/>
    <Param name="@OwnerPlayerDBId" type="BigInt"/>
    <Param name="@ItemType" type="SmallInt"/>
    <Param name="@ItemCount" type="SmallInt"/>
    <Param name="@SlotIndex" type="TinyInt"/>
    <Body>
      <![CDATA[
        UPDATE [dbo].[Inventory] SET ItemCount = (@ItemCount) WHERE ItemType = (@ItemType) AND SlotIndex = (@SlotIndex) AND OwnerAccountDBId = (@OwnerAccountDBId) AND OwnerPlayerDBId = (@OwnerPlayerDBId)
      ]]>
    </Body>
  </Procedure>  
  
  <!-- Inventory에 아이템 있는지 확인 -->
  <Procedure name="spInventoryItemCheck">
    <Param name="@AccountDBId" type="BigInt"/>
    <Param name="@PlayerDbId" type="BigInt"/>
    <Param name="@SlotIndex" type="TinyInt"/>
    <Body>      
      <![CDATA[
        SELECT ItemType, ItemConsumableType, ItemName, ItemCount, IsEquipped, ThumbnailImagePath FROM [dbo].[Inventory] WHERE OwnerAccountDBId = (@AccountDBId) AND OwnerPlayerDBId = (@PlayerDBId) AND SlotIndex = (@SlotIndex)
      ]]>
    </Body>    
  </Procedure>
  
  <!-- InventoryItem Swap -->
  <Procedure name="spInventoryItemSwap">
    <Param name="@OwnerAccountDBId" type="BigInt"/>
    <Param name="@OwnerPlayerDBId" type="BigInt"/>    
    <Param name="@AItemType" type="SmallInt"/>
    <Param name="@AItemConsumableType" type="SmallInt"/>
    <Param name="@AItemName" type="nvarchar(20)"/>
    <Param name="@AItemCount" type="SmallInt"/>
    <Param name="@AItemIsEquipped" type="bit"/>
    <Param name="@AItemThumbnailImagePath" type="nvarchar(100)"/>
    <Param name="@AItemSlotIndex" type="TinyInt"/>    
    <Param name="@BItemType" type="SmallInt"/>
    <Param name="@BItemConsumableType" type="SmallInt"/>
    <Param name="@BItemName" type="nvarchar(20)"/>
    <Param name="@BItemCount" type="SmallInt"/>
    <Param name="@BItemIsEquipped" type="bit"/>
    <Param name="@BItemThumbnailImagePath" type="nvarchar(100)"/>
    <Param name="@BItemSlotIndex" type="TinyInt"/>
    <Body>
      <![CDATA[
        UPDATE [dbo].[Inventory] SET ItemType = (@AItemType), ItemConsumableType = (@AItemConsumableType), ItemName = (@AItemName), ItemCount = (@AItemCount), IsEquipped = (@AItemIsEquipped), ThumbnailImagePath = (@AItemThumbnailImagePath)  WHERE SlotIndex = (@AItemSlotIndex) AND OwnerAccountDBId = (@OwnerAccountDBId) AND OwnerPlayerDBId = (@OwnerPlayerDBId)
        UPDATE [dbo].[Inventory] SET ItemType = (@BItemType), ItemConsumableType = (@BItemConsumableType), ItemName = (@BItemName), ItemCount = (@BItemCount), IsEquipped = (@BItemIsEquipped), ThumbnailImagePath = (@BItemThumbnailImagePath)  WHERE SlotIndex = (@BItemSlotIndex) AND OwnerAccountDBId = (@OwnerAccountDBId) AND OwnerPlayerDBId = (@OwnerPlayerDBId)
      ]]>
    </Body>
  </Procedure>
  
  <!-- InventoryTable에 있는 아이템 가지고 옴-->
  <Procedure name="spGetItemTableInfoToInventory">
    <Param name="@AccountDBId" type="BigInt"/>
    <Param name="@PlayerDBId" type="BigInt"/>
    <Body>
      <![CDATA[
        SELECT ItemType, ItemConsumableType, ItemName, ItemCount, SlotIndex, IsEquipped, ThumbnailImagePath FROM [dbo].[Inventory] WHERE OwnerAccountDBId = (@AccountDBId) AND OwnerPlayerDBId = (@PlayerDBId)
      ]]>
    </Body>
  </Procedure>
  
  <!-- ItemTable에 있는 아이템 삭제 -->
  <Procedure name="spItemDelete">
    <Param name="@ItemDBId" type="BigInt"/>
    <Param name="@ItemUse" type="bit"/>
    <Body>
      <![CDATA[
        UPDATE [dbo].[Item] SET ItemUse = (@ItemUse) WHERE ItemDBId = (@ItemDBId)
      ]]>
    </Body>
  </Procedure>
  
  <!-- SkillTable에 있는 Skill 가지고 오기-->
  <Procedure name="spGetSkill">
    <Param name="@AccountDBId" type="BigInt"/>
    <Param name="@PlayerDBId" type="BigInt"/>
    <Body>
      <![CDATA[
        SELECT SkillType, SkillLevel, SkillName, SkillCoolTime, SlotIndex, SkillImagePath FROM [dbo].[Skill] WHERE AccountDBId = (@AccountDBId) AND PlayerDBId = (@PlayerDBId)
      ]]>
    </Body>
  </Procedure>  
</GameServerDB>
